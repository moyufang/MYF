### 时钟配置

以下寄存器集合到 RCC 结构体中
- CR, CFGR, CIR, APB2RSTR, APB1RSTR, AHBENR, APB2ENR, APB1ENR, CSR
![[stm32f1时钟树.png]]

#### GPIO

推挽输出：
- 结构上由一个 P 型（上管，接VCC）和 N 型（下管，接GND）晶体管组成，两个晶体管由互补信号控制，始终只有一个导通，所以没有高阻态。
- 具有驱动能力强（驱动LED，继电器，蜂鸣器等）、速度快、电平确定的特点。
- 一般不需要上拉或下拉电阻，严禁线与。
开漏输出：
- 结构上只包含一个 N 型晶体管。
- 可能存在上拉电阻，但 stm32 对输出模式不设置上拉或下拉电阻，上拉电阻由作为输入的外设提供。
- 可以线与，故常用于 IIC。
上拉输入：
- 结构上旁接一个 P 型晶体管，悬空时是高电平
- 避免噪声导致悬空时误触发为低电平
下拉输入：
- 结构上旁接一个 N 型晶体管
- 避免噪声导致悬空时误触发为高电平
模拟输入：
- 完全禁用上下拉电阻（包括内部和外部），绕过数字电路直连 ADC 采样器
浮空输入：
- 内部无上下拉电阻，靠外部拉电阻驱动，信号到数字输入缓冲器

寄存器
1. 在 RCC->APB2ENR 开启 GPIO 口时钟使能
2. 配置 CRL 或 CRH 来设置 IO 口的属性
3. 通过 IDR、ODR 来读入、写出
4. BSRR 或 BRR 来置位、复位每一位
![[GPIO端口配置表.png]]
- GPIO 做 USART 的 RX 时，模式是“浮空输入”，TX 时模式是“复用推挽”
- 
### AFIO
1. 在 RCC->APB2ENR 开启 AFIO 时钟和 GPIO 时钟
2. 事件控制寄存器 AFIO->EVCR
3. 复用重映射 AFIO->MAPR
4. 外部中断配置寄存器 AFIO->EXTICR1, EXTICR2, EXTICR3, EXTICR4

### EXTI
1. 20 个中断线使能 EXTI->IMR，20 个事件线使能 EXTI->EMR
2. 20 个外部中断触发选择器，上升沿 EXTI->RTSR，下降沿 EXTI->FTSR
3. 20 个软件中断事件器 EXTI->SWIER，写 1 时挂起，依据 IMR 和 EMR 悬起对应中断和事件
4. 20 个挂起寄存器 EXTI->PR，读入为 1 时说明对应中断或事件被挂起，写入 1 时清除该中断或事件。响应中断或事件后，必须在 EXTI->PR 清除对应位

### USART

以下寄存器集合到 USART 结构体中
- SR, DR, BRR, CR1, CR2, CR3

配置
1. 开启 GPIO 口时钟使能，开启 APB2 的串口外设时钟使能
2. 配置波特率
3. 使能 CR1->UE 打开 USART 模块，CR2->STOP 设置停止位，使能 CR1->RE 与 CR1->TE 打开接受器和发送器
4. 中断使能：CR1->RXNEIE 接受完时产生中断，CR1->TCIE 发送完成时产生中断